+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"};for(var i in t)if(void 0!==e.style[i])return{end:t[i]}}e.fn.removeClassPrefix=function(e){return this.each(function(t,i){var o=i.className.split(" ").map(function(t){return 0===t.indexOf(e)?"":t});i.className=o.join(" ")}),this},e.fn.emulateTransitionEnd=function(t){var i=!1,o=this;e(this).one(e.support.transition.end,function(){i=!0});var n=function(){i||e(o).trigger(e.support.transition.end)};return setTimeout(n,t),this},e.fn.transitionEnd=function(t,i){var o=!1,n=this;t&&(t=e.proxy(t,n)),e(this).one(e.support.transition.end,function(){o=!0,t&&t()});var a=function(){o||e(n).trigger(e.support.transition.end)};return setTimeout(a,i),this},e.fn.classAnimoEnd=function(t,i){var o=this;return i&&(i=e.proxy(i,o)),e(o).removeClass("animated "+t).one(e.support.animate.end,function(){i&&i(),e(o).removeClass("animated")}).addClass("animated "+t),e(o).is(":visible")||e(o).show(),this},e(function(){e.support.transition=t(),e.support.animate={end:"webkitAnimationEnd animationend"}})}(window.$),!function(e){var t;t=function(){function e(){}return e.prototype.setup=function(e,t,i,o){var n,a;return null==i&&(i=1),a=t.w/e.w,n=t.h/e.h,this.minZoom=(null!=o?o.fitWidth:void 0)&&!(null!=o?o.fitHeight:void 0)?a:(null!=o?o.fitHeight:void 0)&&!(null!=o?o.fitWidth:void 0)?n:(null!=o?o.fitWidth:void 0)&&(null!=o?o.fitHeight:void 0)?n>a?a:n:n>a?n:a,this.maxZoom=1/i>this.minZoom?1/i:this.minZoom},e.prototype.getZoom=function(e){return this.minZoom&&this.maxZoom?e*(this.maxZoom-this.minZoom)+this.minZoom:null},e.prototype.getSliderPos=function(e){return this.minZoom&&this.maxZoom?this.minZoom===this.maxZoom?0:(e-this.minZoom)/(this.maxZoom-this.minZoom):null},e.prototype.isZoomable=function(){return this.minZoom&&this.maxZoom?this.minZoom!==this.maxZoom:null},e.prototype.fixZoom=function(e){return this.minZoom>e?this.minZoom:e>this.maxZoom?this.maxZoom:e},e}();var i;i=function(){function i(t,o){var n;this.element=t,this.$el=e(this.element),n={$fileInput:this.$("input.cropit-image-input"),$preview:this.$(".cropit-image-preview"),$zoomSlider:this.$("input.cropit-image-zoom-input"),$previewContainer:this.$(".cropit-image-preview-container")},this.options=e.extend({},i._DEFAULTS,n,o),this.init()}return i._DEFAULTS={exportZoom:1,imageBackground:!1,imageBackgroundBorderWidth:0,imageState:null,allowCrossOrigin:!1},i.PREVIEW_EVENTS=function(){return["mousedown","mouseup","mouseleave","touchstart","touchend","touchcancel","touchleave"].map(function(e){return""+e+".cropit"}).join(" ")}(),i.PREVIEW_MOVE_EVENTS="mousemove.cropit touchmove.cropit",i.ZOOM_INPUT_EVENTS=function(){return["mousemove","touchmove","change"].map(function(e){return""+e+".cropit"}).join(" ")}(),i.prototype.init=function(){var i,o,n,a,s;return this.image=new Image,this.options.allowCrossOrigin&&(this.image.crossOrigin="Anonymous"),this.$fileInput=this.options.$fileInput.attr({accept:"image/*"}),this.$preview=this.options.$preview.css({backgroundRepeat:"no-repeat"}),this.$zoomSlider=this.options.$zoomSlider.attr({min:0,max:1,step:.01}),this.previewSize={w:this.options.width||this.$preview.width(),h:this.options.height||this.$preview.height()},this.options.width&&this.$preview.width(this.previewSize.w),this.options.height&&this.$preview.height(this.previewSize.h),this.options.imageBackground&&(o=this.options.imageBackgroundBorderWidth,i=this.options.$previewContainer,this.$imageBg=e("<img />").addClass("cropit-image-background").attr("alt","").css("position","absolute"),this.$imageBgContainer=e("<div />").addClass("cropit-image-background-container").css({position:"absolute",zIndex:0,left:-o+window.parseInt(this.$preview.css("border-left-width")),top:-o+window.parseInt(this.$preview.css("border-top-width")),width:this.previewSize.w+2*o,height:this.previewSize.h+2*o}).append(this.$imageBg),o>0&&this.$imageBgContainer.css({overflow:"hidden"}),i.css("position","relative").prepend(this.$imageBgContainer),this.$preview.css("position","relative"),this.$preview.hover(function(e){return function(){return e.$imageBg.addClass("cropit-preview-hovered")}}(this),function(e){return function(){return e.$imageBg.removeClass("cropit-preview-hovered")}}(this))),this.initialOffset={x:0,y:0},this.initialZoom=0,this.initialZoomSliderPos=0,this.imageLoaded=!1,this.moveContinue=!1,this.zoomer=new t,this.bindListeners(),this.$zoomSlider.val(this.initialZoomSliderPos),this.setOffset((null!=(n=this.options.imageState)?n.offset:void 0)||this.initialOffset),this.zoom=(null!=(a=this.options.imageState)?a.zoom:void 0)||this.initialZoom,this.loadImage((null!=(s=this.options.imageState)?s.src:void 0)||null)},i.prototype.bindListeners=function(){return this.$fileInput.on("change.cropit",this.onFileChange.bind(this)),this.$preview.on(i.PREVIEW_EVENTS,this.onPreviewEvent.bind(this)),this.$zoomSlider.on(i.ZOOM_INPUT_EVENTS,this.onZoomSliderChange.bind(this))},i.prototype.unbindListeners=function(){return this.$fileInput.off("change.cropit"),this.$preview.off(i.PREVIEW_EVENTS),this.$zoomSlider.off(i.ZOOM_INPUT_EVENTS)},i.prototype.reset=function(){return this.zoom=this.initialZoom,this.offset=this.initialOffset},i.prototype.onFileChange=function(){var e,t,i;return"function"==typeof(i=this.options).onFileChange&&i.onFileChange(),t=new FileReader,e=this.$fileInput.get(0).files[0],(null!=e?e.type.match("image"):void 0)?(this.setImageLoadingClass(),t.readAsDataURL(e),t.onload=this.onFileReaderLoaded.bind(this),t.onerror=this.onFileReaderError.bind(this)):void 0},i.prototype.onFileReaderLoaded=function(e){return this.reset(),this.loadImage(e.target.result)},i.prototype.onFileReaderError=function(){var e;return"function"==typeof(e=this.options).onFileReaderError?e.onFileReaderError():void 0},i.prototype.loadImage=function(e){var t;return this.imageSrc=e,this.imageSrc?("function"==typeof(t=this.options).onImageLoading&&t.onImageLoading(),this.setImageLoadingClass(),this.image.onload=this.onImageLoaded.bind(this),this.image.onerror=this.onImageError.bind(this),this.image.src=this.imageSrc):void 0},i.prototype.onImageLoaded=function(){var e;return this.setImageLoadedClass(),this.setOffset(this.offset),this.$preview.css("background-image","url("+this.imageSrc+")"),this.options.imageBackground&&this.$imageBg.attr("src",this.imageSrc),this.imageSize={w:this.image.width,h:this.image.height},this.setupZoomer(),this.imageLoaded=!0,"function"==typeof(e=this.options).onImageLoaded?e.onImageLoaded():void 0},i.prototype.onImageError=function(){var e;return"function"==typeof(e=this.options).onImageError?e.onImageError():void 0},i.prototype.setImageLoadingClass=function(){return this.$preview.removeClass("cropit-image-loaded").addClass("cropit-image-loading")},i.prototype.setImageLoadedClass=function(){return this.$preview.removeClass("cropit-image-loading").addClass("cropit-image-loaded")},i.prototype.getEventPosition=function(e){var t,i,o,n;return(null!=(t=e.originalEvent)&&null!=(i=t.touches)?i[0]:void 0)&&(e=null!=(o=e.originalEvent)&&null!=(n=o.touches)?n[0]:void 0),e.clientX&&e.clientY?{x:e.clientX,y:e.clientY}:void 0},i.prototype.onPreviewEvent=function(t){return this.imageLoaded?(this.moveContinue=!1,this.$preview.off(i.PREVIEW_MOVE_EVENTS),"mousedown"===t.type||"touchstart"===t.type?(this.origin=this.getEventPosition(t),this.moveContinue=!0,this.$preview.on(i.PREVIEW_MOVE_EVENTS,this.onMove.bind(this))):e(document.body).focus(),t.stopPropagation(),!1):void 0},i.prototype.onMove=function(e){var t;return t=this.getEventPosition(e),this.moveContinue&&t&&this.setOffset({x:this.offset.x+t.x-this.origin.x,y:this.offset.y+t.y-this.origin.y}),this.origin=t,e.stopPropagation(),!1},i.prototype.setOffset=function(e){return this.offset=this.fixOffset(e),this.$preview.css("background-position",""+this.offset.x+"px "+this.offset.y+"px"),this.options.imageBackground?this.$imageBg.css({left:this.offset.x+this.options.imageBackgroundBorderWidth,top:this.offset.y+this.options.imageBackgroundBorderWidth}):void 0},i.prototype.fixOffset=function(e){var t;return this.imageLoaded?(t={x:e.x,y:e.y},this.imageSize.w*this.zoom<=this.previewSize.w?t.x=0:t.x>0?t.x=0:t.x+this.imageSize.w*this.zoom<this.previewSize.w&&(t.x=this.previewSize.w-this.imageSize.w*this.zoom),this.imageSize.h*this.zoom<=this.previewSize.h?t.y=0:t.y>0?t.y=0:t.y+this.imageSize.h*this.zoom<this.previewSize.h&&(t.y=this.previewSize.h-this.imageSize.h*this.zoom),t.x=this.round(t.x),t.y=this.round(t.y),t):e},i.prototype.onZoomSliderChange=function(){var e;return this.imageLoaded?(this.zoomSliderPos=Number(this.$zoomSlider.val()),e=this.zoomer.getZoom(this.zoomSliderPos),this.setZoom(e)):void 0},i.prototype.enableZoomSlider=function(){var e;return this.$zoomSlider.removeAttr("disabled"),"function"==typeof(e=this.options).onZoomEnabled?e.onZoomEnabled():void 0},i.prototype.disableZoomSlider=function(){var e;return this.$zoomSlider.attr("disabled",!0),"function"==typeof(e=this.options).onZoomDisabled?e.onZoomDisabled():void 0},i.prototype.setupZoomer=function(){return this.zoomer.setup(this.imageSize,this.previewSize,this.options.exportZoom,this.options),this.zoom=this.fixZoom(this.zoom),this.setZoom(this.zoom),this.isZoomable()?this.enableZoomSlider():this.disableZoomSlider()},i.prototype.setZoom=function(e){var t,i,o,n,a;return e=this.fixZoom(e),a=this.round(this.imageSize.w*e),n=this.round(this.imageSize.h*e),o=this.zoom,t=this.previewSize.w/2-(this.previewSize.w/2-this.offset.x)*e/o,i=this.previewSize.h/2-(this.previewSize.h/2-this.offset.y)*e/o,this.zoom=e,this.setOffset({x:t,y:i}),this.zoomSliderPos=this.zoomer.getSliderPos(this.zoom),this.$zoomSlider.val(this.zoomSliderPos),this.$preview.css("background-size",""+a+"px "+n+"px"),this.options.imageBackground?this.$imageBg.css({width:a,height:n}):void 0},i.prototype.fixZoom=function(e){return this.zoomer.fixZoom(e)},i.prototype.isZoomable=function(){return this.zoomer.isZoomable()},i.prototype.getCroppedImageData=function(t){var i,o,n,a,s;return this.imageSrc?(a={type:"image/png",quality:.75,originalSize:!1},t=e.extend({},a,t),n={w:this.previewSize.w,h:this.previewSize.h},this.options.fitHeight&&!this.options.fitWidth&&this.imageSize.w*this.zoom<this.previewSize.w?n.w=this.imageSize.w*this.zoom:this.options.fitWidth&&!this.options.fitHeight&&this.imageSize.h*this.zoom<this.previewSize.h&&(n.h=this.imageSize.h*this.zoom),s=t.originalSize?1/this.zoom:this.options.exportZoom,i=e("<canvas />").attr({width:n.w*s,height:n.h*s}).get(0),o=i.getContext("2d"),o.drawImage(this.image,this.offset.x*s,this.offset.y*s,this.zoom*s*this.imageSize.w,this.zoom*s*this.imageSize.h),i.toDataURL(t.type,t.quality)):null},i.prototype.getImageState=function(){return{src:this.imageSrc,offset:this.offset,zoom:this.zoom}},i.prototype.getImageSrc=function(){return this.imageSrc},i.prototype.getOffset=function(){return this.offset},i.prototype.getZoom=function(){return this.zoom},i.prototype.getImageSize=function(){return this.imageSize?{width:this.imageSize.w,height:this.imageSize.h}:null},i.prototype.getPreviewSize=function(){return{width:this.previewSize.w,height:this.previewSize.h}},i.prototype.setPreviewSize=function(e){return(null!=e?e.width:void 0)>0&&(null!=e?e.height:void 0)>0?(this.previewSize={w:e.width,h:e.height},this.$preview.css({width:this.previewSize.w,height:this.previewSize.h}),this.options.imageBackground&&this.$imageBgContainer.css({width:this.previewSize.w+2*this.options.imageBackgroundBorderWidth,height:this.previewSize.h+2*this.options.imageBackgroundBorderWidth}),this.imageLoaded?this.setupZoomer():void 0):void 0},i.prototype.disable=function(){return this.unbindListeners(),this.disableZoomSlider(),this.$el.addClass("cropit-disabled")},i.prototype.reenable=function(){return this.bindListeners(),this.enableZoomSlider(),this.$el.removeClass("cropit-disabled")},i.prototype.round=function(e){return Math.round(1e5*e)/1e5},i.prototype.$=function(e){return this.$el?this.$el.find(e):null},i}();var o,n;o="cropit",n={init:function(t){return this.each(function(){var n;return e.data(this,o)?void 0:(n=new i(this,t),e.data(this,o,n))})},destroy:function(){return this.each(function(){return e.removeData(this,o)})},isZoomable:function(){var e;return e=this.first().data(o),null!=e?e.isZoomable():void 0},"export":function(e){var t;return t=this.first().data(o),null!=t?t.getCroppedImageData(e):void 0},imageState:function(){var e;return e=this.first().data(o),null!=e?e.getImageState():void 0},imageSrc:function(t){var i;return null!=t?this.each(function(){var i;return i=e.data(this,o),null!=i&&i.reset(),null!=i?i.loadImage(t):void 0}):(i=this.first().data(o),null!=i?i.getImageSrc():void 0)},offset:function(t){var i;return null!=t&&null!=t.x&&null!=t.y?this.each(function(){var i;return i=e.data(this,o),null!=i?i.setOffset(t):void 0}):(i=this.first().data(o),null!=i?i.getOffset():void 0)},zoom:function(t){var i;return null!=t?this.each(function(){var i;return i=e.data(this,o),null!=i?i.setZoom(t):void 0}):(i=this.first().data(o),null!=i?i.getZoom():void 0)},imageSize:function(){var e;return e=this.first().data(o),null!=e?e.getImageSize():void 0},previewSize:function(t){var i;return null!=t?this.each(function(){var i;return i=e.data(this,o),null!=i?i.setPreviewSize(t):void 0}):(i=this.first().data(o),null!=i?i.getPreviewSize():void 0)},disable:function(){return this.each(function(){var t;return t=e.data(this,o),t.disable()})},reenable:function(){return this.each(function(){var t;return t=e.data(this,o),t.reenable()})}},e.fn.cropit=function(e){return n[e]?n[e].apply(this,[].slice.call(arguments,1)):n.init.apply(this,arguments)}}(window.jQuery),function(e,t){function i(){if(this.hasDeviceMotion="ondevicemotion"in e,this.threshold=15,this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null,"function"==typeof t.CustomEvent)this.event=new t.CustomEvent("shake",{bubbles:!0,cancelable:!0});else{if("function"!=typeof t.createEvent)return!1;this.event=t.createEvent("Event"),this.event.initEvent("shake",!0,!0)}}i.prototype.reset=function(){this.lastTime=new Date,this.lastX=null,this.lastY=null,this.lastZ=null},i.prototype.start=function(){this.reset(),this.hasDeviceMotion&&e.addEventListener("devicemotion",this,!1)},i.prototype.stop=function(){this.hasDeviceMotion&&e.removeEventListener("devicemotion",this,!1),this.reset()},i.prototype.devicemotion=function(t){var i,o,n=t.accelerationIncludingGravity,a=0,s=0,r=0;return null===this.lastX&&null===this.lastY&&null===this.lastZ?(this.lastX=n.x,this.lastY=n.y,this.lastZ=n.z,void 0):(a=Math.abs(this.lastX-n.x),s=Math.abs(this.lastY-n.y),r=Math.abs(this.lastZ-n.z),(a>this.threshold&&s>this.threshold||a>this.threshold&&r>this.threshold||s>this.threshold&&r>this.threshold)&&(i=new Date,o=i.getTime()-this.lastTime.getTime(),o>1e3&&(e.dispatchEvent(this.event),this.lastTime=new Date)),this.lastX=n.x,this.lastY=n.y,this.lastZ=n.z,void 0)},i.prototype.handleEvent=function(e){return"function"==typeof this[e.type]?this[e.type](e):void 0};var o=new i;o&&o.start()}(window,document);var IFR=IFR||{};IFR.Store=function(e){function t(){try{return n in e&&e[n]}catch(t){return!1}}var i,o={},n="localStorage";o.disabled=!1,o.set=function(){},o.get=function(){},o.remove=function(){},o.clear=function(){},o.transact=function(e,t,i){var n=o.get(e);null==i&&(i=t,t=null),n===void 0&&(n=t||{}),i(n),o.set(e,n)},o.getAll=function(){},o.forEach=function(){},o.serialize=function(e){return JSON.stringify(e)},o.deserialize=function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},t()&&(i=e[n],o.set=function(e,t){try{if(void 0===t)return o.remove(e);i.setItem(e,o.serialize(t))}catch(n){if("QUOTA_EXCEEDED_ERR"==n.name.toUpperCase())return!1}return t},o.get=function(e){return o.deserialize(i.getItem(e))},o.remove=function(e){i.removeItem(e),i.removeItem(e+"_timestamp"),o._removeKeyChangeListener(e)},o.clear=function(){o.storageEventCallbacks=[],i.clear()},o.getAll=function(){var e={};return o.forEach(function(t,i){e[t]=i}),e},o.forEach=function(e){for(var t=0;i.length>t;t++){var n=i.key(t);e(n,o.get(n))}});try{var a="__storejs__";o.set(a,a),o.get(a)!=a&&(o.disabled=!0),o.remove(a)}catch(s){o.disabled=!0}return o.enabled=!o.disabled,o}(window);var IFR=IFR||{};(function(e){IFR.loadImage=function(e,t,i){var o=new Image;if(i){var n=function(){o.onload=null,o.onerror=null,i(e,t),o=null};o.onerror=function(){console.log(e),n(!1)},o.onload=function(){n()}}o.src=e},IFR.imgLoader=function(e,t,i){var o=e.length,n=0;t||(t=function(){}),i||(i=function(){});for(var a=e.length,s=function(e){a--,t(e,o-a,o),0===a&&i()},n=0;e.length>n;n++)IFR.loadImage(e[n],n,s)};var t=document.getElementById("loading_rate");document.getElementById("bar");var i=0;IFR.sourcesLoaded=function(o,n,a){IFR.imgLoader(o,function(e,o,n){i=o/n,t.innerHTML=Math.floor(100*i)+"%"},function(){"function"==typeof n&&n(),e("#loading").transitionEnd(function(){"function"==typeof a&&a(),e(this).hide()},1e3)})}})(window.$);var ns=ns||{},_shareData={imgUrl:"",link:"",desc:"",title:"",success:function(){},cancel:function(){}},_weixinShareCall=function(){wx.onMenuShareAppMessage(_shareData),wx.onMenuShareTimeline(_shareData)},_weixinShareCallAttached=!1;ns.clearWeixinShareData=function(){ns.setWeixinShareData(null)},ns.setWeixinShareData=function(e){return e||(e={}),_shareData.imgUrl=e.imgUrl,_shareData.link=e.link,_shareData.link||(_shareData.link=window.location.href),_shareData.title=e.title,_shareData.title||(_shareData.title=document.title),_shareData.success=e.success,_shareData.cancel=e.cancel,wx&&wx.ready?(!_weixinShareCallAttached&&wx.ready(_weixinShareCall),_weixinShareCallAttached=!0,void 0):(alert("errorCode -101."),void 0)},ns.getNetworkType=function(e){wx.ready(function(){wx.getNetworkType({success:function(t){e&&e(t.networkType)}})})},console.log("^_^ 我们正在招聘前端工程师，请发送简历到 johnxiao@ifanr.com");var App=App||{};App.$appEl=$("#lomo2014-scene"),App.$mail=$("#mail"),App.prevScene=null,App.currentScene=null,App.scenes={},App.scenesEl={create:"#view-create",album:"#view-album",single:"#view-single"},App.storePrefix="lomo2014_",App.lsGet=function(e){return IFR.Store.get(App.storePrefix+e)},App.lsSet=function(e,t){return IFR.Store.set(App.storePrefix+e,t)},App.openedMails=App.lsGet("is_viewed")||[],App.is_created=App.lsGet("is_created")||[],App.is_voted=App.lsGet("is_voted")||[],App.isMyCreated=function(){return $.inArray(App.currentMailId,App.is_created)>-1},App.checkVoted=function(){return $.inArray(App.currentMailId,App.is_voted)>-1},App.addToVoted=function(e){App.is_voted.push(e),App.lsSet("is_voted",App.is_voted)},App.showBg=function(e){$("#bg #bg-"+e).fadeIn().siblings().fadeOut()},App.storedWechatName=App.lsGet("wechat_name"),App.fetchAlbumCount=0,App.apiCountView=function(e,t){if(App.currentMailId&&!(App.currentMailType||$.inArray(App.currentMailId,App.openedMails)>-1)){var i=App.currentMailId;$.post("api.php?action=count_view",{lomo_id:App.currentMailId},function(o){-1>=$.inArray(i,App.openedMails)&&(App.openedMails.push(i),App.lsSet("is_viewed",App.openedMails)),i===App.currentMailId&&(o.status?e(o):"-2"!==o.error_code&&t&&t(o))},"json")}},App.apiShareCount=function(){App.currentMailId&&(App.currentMailType||$.post("api.php?action=count_weixin_share",{lomo_id:App.currentMailId},function(){},"json"))},App.apiThumbUp=function(e,t,i,o){if(!("album"===App.currentScene&&App.currentMailType||App.checkVoted())){var n={lomo_id:e};"album"===App.currentScene&&(n.count_view=!0),o&&(n.down=!0),$.post("api.php?action=thumbup",n,function(o){o.status&&App.addToVoted(e),e===App.currentMailId&&(o.status?t&&t(o):"-2"!==o.error_code&&i&&i(o))},"json")}},App.apiRandom=function(e,t){var i=App.getUnique(App.is_created.concat(App.openedMails));$.post("api.php?action=random",{exclude:i},function(i){App.fetchAlbumCount++,i.status?e(i.data):"-2"!==i.error_code&&t&&t(i)},"json")},App.apiCreate=function(e,t){e.lomo_id=App.currentMailId,$.post("api.php?action=create",e,function(i){i.status&&(App.is_created.push(e.lomo_id),App.lsSet("is_created",App.is_created)),setTimeout(function(){t(i)},1e3)},"json").fail(function(e){t(e)})},App.apiFetchIp=function(e){$.get("api.php?action=city",function(t){App.cityFetched=!0,t.status?(App.city=t.data,App.city&&e&&e(App.city)):"-2"!==t.error_code&&console.log(t)},"json")},App.preloadLomos=function(){App.apiRandom(function(e){if(e&&e.length){bootData.album_array=e;for(var t=[],i=e.length-1;i>=0;i--)t.push(e[i].src);IFR.imgLoader(t)}else bootData.album_array=[]})};var $gameTipOverlayer=$("#game-tip-overlayer");IFR.showTipMask=function(e,t,i){if($gameTipOverlayer.fadeIn("fast"),e&&$(e).length){if($el=$(e),t===void 0&&(t=!1),$el.fadeIn("fast"),$gameTipOverlayer.off(),t===!0)return;$el.one("touchstart click",function(){IFR.hideTipMask(e),i&&i()});var o="click.tips"+e.substring(1);$gameTipOverlayer.off(o).on(o,function(){IFR.hideTipMask(e),i&&i()})}$("#secs, #bg").addClass("blur")},IFR.hideTipMask=function(e,t){$el=e.jquery?e:$(e);var i="click.tips"+e.substring(1);!t&&$el&&$el.off().fadeOut("fast"),$gameTipOverlayer.off(i).fadeOut("fast"),$("#secs, #bg").removeClass("blur")},App.getContenteditableSelection=function(e){var t,i;document.body.createTextRange?(t=document.body.createTextRange(),t.moveToElementText(e),t.select()):window.getSelection&&(i=window.getSelection(),t=document.createRange(),t.selectNodeContents(e),i.removeAllRanges(),i.addRange(t))},App.nl2br=function(e,t){var i=t||t===void 0?"<br />":"<br>";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+i+"$2")},App.countChinese=function(e){var t=e.match(/[\u4e00-\u9fff\uf900-\ufaff]/g);return t?t.length:0},App.countNonAlphabet=function(e){var t=e.match(/[^\x00-\x80]/g);return t?t.length:0},App.getUnique=function(e){for(var t={},i=[],o=0,n=e.length;n>o;++o)t.hasOwnProperty(e[o])||(i.push(e[o]),t[e[o]]=1);return i};var getUnix=function(){return Math.round(+new Date/1e3)};App.scenes.single={},App.scenes.single.init=function(){var e=this;e.sceneName="single",e.$el=$(App.scenesEl[e.sceneName]),App.showBg("album"),bootData&&bootData.lomo_img&&$("#lomo").append("<img src="+bootData.lomo_img+" />");var t=function(){var t=App.lsGet("view-all-unlock");t||App.lsSet("view-all-unlock",1),setTimeout(function(){IFR.hideTipMask("#tip-share-01"),App.isMyCreated()&&IFR.showTipMask("#tip-album-open",!1,function(){e.leave()})},100)};ns.setWeixinShareData({imgUrl:bootData.lomo_img_thumb,success:t}),App.isMyCreated()?($("#share-my-lomo").show(),$("#share-my-lomo-tip").show(),$("#self-lomo-share-tip").show()):App.apiCountView(),App.lsGet("view-all-unlock")&&$("#goto-album-btn").show(),App.prevScene?"create"==App.prevScene&&($("#share-my-lomo-tip").hide(),e.$el.find(".js-action").hide(),$(".js-status-text").hide(),$(".white-loading").hide(),$("#js-fuji").removeClass("animate-bounceIn").classAnimoEnd("animo-bounceOutUp",function(){IFR.hideTipMask(".js-tip-create-waiting",!0),e.$el.classAnimoEnd("animo-bounceInDown",function(){setTimeout(function(){e.$el.find(".js-action").fadeIn(),$("#share-my-lomo-tip").fadeIn(),setTimeout(function(){IFR.hideTipMask(".js-tip-create-waiting"),e.logosEnter()},1e3)},400)})})):e.$el.removeClass("animate-bounceIn").classAnimoEnd("animate-bounceIn",function(){e.logosEnter()}),e.domEventsInited||e.initDomEvent(),e.exitScene=function(){ns.clearWeixinShareData()}},App.scenes.single.logosEnter=function(){$(".logos").removeClass("animate-bounceIn").classAnimoEnd("animate-bounceIn",function(){$(".logo-img").removeClass("animate-swing").classAnimoEnd("animate-swing")})},App.scenes.single.leave=function(){$(".logos").classAnimoEnd("animate-bounceOut",function(){App.transToScene("album",!0)})},App.scenes.single.initDomEvent=function(){var e=this;e.domEventsInited=!0,App.checkVoted()||App.isMyCreated()?($("#thumb-btn").find("span").first().hide().siblings().show(),$("#rating-count").show()):$("#thumb-btn").on("click",function(t){var i=$(t.currentTarget);i.attr("disabled","disabled"),$firstSpan=i.find("span").first().text("."),e.interval=window.setInterval(function(){var e=$firstSpan.text();3>e.length?$firstSpan.text(e+"."):$firstSpan.text(".")},500);var o=function(t){t.status&&t.data&&e.$el.find("#rating-count").text(t.data).show(),$firstSpan.hide(),$firstSpan.next().classAnimoEnd("animate-bounceIn"),window.clearInterval(e.interval)};App.apiThumbUp(App.currentMailId,o,o)}),$("#goto-album-btn").on("click",function(){e.leave()})},App.scenes.album={},App.scenes.album.init=function(){var e=this;e.sceneName="album",e.$el=$(App.scenesEl[e.sceneName]),e.$lomos=e.$el.find("#lomos"),e.$shareBtn=e.$el.find(".js-action"),App.showBg("album"),$("#self-lomo-share-tip").hide(),App.$mail.remove(),e.$tipSkiped=e.$el.find("#tip-skiped"),e.$tipThumbed=e.$el.find("#tip-thumbed"),App.prevScene?e.$el.fadeIn():e.$el.addClass("animated bounceIn").show(),e.shakeEventCb(),e.domEventsInited||e.initDomEvent(),e.exitScene=function(){window.removeEventListener("shake",$.proxy(e.shakeEventCb,e),!1)}},App.scenes.album.initDomEvent=function(){var e=this;e.domEventsInited=!0,window.addEventListener("shake",$.proxy(e.shakeEventCb,e),!1)},App.scenes.album.shakeEventCb=function(){var e=this;return App.lockShake?!1:(App.lockShake=!0,$("#js-tip-album-last").hide(),IFR.showTipMask("#load-album-waiting",!0),e.$shareBtn.hide(),bootData.album_array?(e.fillAlbum(bootData.album_array),bootData.album_array=null):App.apiRandom(function(t){e.fillAlbum(t)}),void 0)},App.scenes.album.fillAlbum=function(e){var t=this;if(t.currentAlbum=e,e){if(!e.length)return IFR.hideTipMask("#load-album-waiting"),IFR.showTipMask("#tip-over-01"),void 0;var i=e.length-1,o=function(){IFR.loadImage(e[i].src,i,function(){return t.fillAlbumItem(e[i],i,i===e.length-1),0===i?(IFR.hideTipMask("#load-album-waiting"),1>=App.fetchAlbumCount&&IFR.showTipMask("#tip-gesture-01"),$("#lomos img").show(),t.nextLomo(e.length-1),$("#js-tip-album-last").hide(),t.$shareBtn.fadeIn(),void 0):(i--,o(),void 0)})};o()}},App.scenes.album.fillAlbumItem=function(e,t,i){var o=this,n=" z-index: "+t+"; ";!i&&(n+=" display: none; "),$item=$('<img style="-webkit-transform: matrix(1, 0, 0, 1, 0, 0); '+n+' "data-idx="'+t+'" " id="'+e.lomo_id+'" src='+e.src+" />"),o.$lomos.append($item),o.bindTouch($item)},App.scenes.album.bindTouch=function(e){function t(e){var t=$(e.target);return h.movePrevent===!0?(event.preventDefault(),!1):(touchDown=!0,n=e.pageX,a=e.pageY,t.addClass("drag"),l=t.css("-webkit-transform"),l=l.replace("matrix(",""),l=l.replace(")",""),l=l.split(","),l=parseInt(l[5]),void 0)}function i(e){var t=$(e.target);if(h.movePrevent===!0||touchDown!==!0)return event.preventDefault(),!1;if(event.preventDefault(),s=e.pageY,c===!1&&s!=a){var i=l+s-a,o=-(i/3.6),n=Math.cos(o*Math.PI/180),r=Math.sin(o*Math.PI/180),p="matrix("+n.toFixed(6)+","+r.toFixed(6)+","+(-1*r).toFixed(6)+","+n.toFixed(6)+",0, "+i+")";h.setMatrix(t[0],p)}}function o(e){var t=$(e.target);return h.movePrevent===!0?(event.preventDefault(),!1):(touchDown=!1,c===!1&&(r=e.pageX,p=e.pageY,100>=Math.abs(p-a)?h.setMatrix(t[0],"matrix(1, 0, 0, 1, 0, 0)"):h.touchCallback(t,p>a?"skip":"thumbed")),t.removeClass("drag"),void 0)}var n,a,s,r,p,h=this,c=!1,l=0;e[0].addEventListener("touchstart",function(e){e=e.changedTouches[0],t(e)}),e[0].addEventListener("touchmove",function(e){i(e.changedTouches[0],e)}),e[0].addEventListener("touchend",function(e){o(e.changedTouches[0])})},App.scenes.album.touchCallback=function(e,t){var i,o=this,n=parseInt(e.attr("data-idx"),10);"thumbed"==t?(i=o.$tipThumbed,App.apiThumbUp(App.currentMailId)):(App.apiThumbUp(App.currentMailId,null,null,!0),i=o.$tipSkiped);var a=o.currentAlbum[n];if(a.rating||(a.rating=0),$("#album-rating-count").text(a.rating),0===n&&(App.lockShake=!1,o.$shareBtn.hide(),App.currentMailId=null),i.siblings().hide(),i.hide().classAnimoEnd("bounceIn").delay(100).removeClass("bounceIn").classAnimoEnd("bounceOut",function(){$(this).hide(),0===n&&$("#js-tip-album-last").show()}),e.transitionEnd(function(){e.off().remove(),n--,o.nextLomo(n)},1e3),"skip"==t){var s="matrix(0.373707, -0.927547, 0.927547, 0.373707, 0, 1245)";o.setMatrix(e[0],s,!0)}else{var r="matrix(0.802123, 0.597159, -0.597159, 0.802123, 0, -832)";o.setMatrix(e[0],r,!0)}},App.scenes.album.setMatrix=function(e,t,i){i&&(e.style.webkitTransition="-webkit-transform 1s"),e.style.webkitTransform=t},App.scenes.album.nextLomo=function(e){var t=this;if(e>=0){var i=t.currentAlbum[e];if(i.c_type)return;App.currentMailId=i.lomo_id,App.currentMailType=i.c_type,ns.setWeixinShareData({imgUrl:i.src,link:LOMO_LENOVO_HOME+"?ifr_lomo_id="+i.lomo_id,success:function(){App.apiShareCount()}})}6===e&&App.preloadLomos()},App.scenes.create={},App.scenes.create.init=function(){var e=this;e.sceneName="create",e.$el=$(App.scenesEl[e.sceneName]),e.$mid2014Mailbox=$("#mid2014-mailbox"),App.apiFetchIp(function(e){$("#city").text(e)}),e.$receiver=$("#receiver"),e.$wechatName=$("#wechat_name"),e.$wechatNameForShow=$("#wechat-name-for-show"),e.$isShowWechatName=$("#is_show_wechat_name"),e.$is_show_city=$("#is_show_city"),e.$submitBtn=$("#create-card"),e.$message=$("#message"),e.$el.find("#city").show(),e.$el.fadeIn(),e.domEventsInited||e.initDomEvent(),e.$wechatName.val(App.storedWechatName),e.$wechatNameForShow.text(App.storedWechatName),e.exitScene=function(){}},App.scenes.create.initDomEvent=function(){var e=this;e.domEventsInited=!0,e.initImageCropper();var t=function(){e.$isShowWechatName[0].checked?e.$wechatNameForShow.text(e.$wechatName.val()):e.$wechatNameForShow.text("")};e.$wechatName.on("keyup",t),e.$isShowWechatName.on("click",function(){e.$el.find("#name-wrap").toggle(),t()}),e.$is_show_city.on("click",function(){!App.cityFetched&&App.apiFetchIp(),e.$el.find("#city").toggle()}),e.$submitBtn.on("click",function(){return e.$submitBtn.attr("disabled","disabled"),e.createMail(),!1})},App.scenes.create.getImgOffset=function(){var e=this;if(e.imageLoaded){var t=e.$imageCropper.cropit("zoom"),i=e.$imageCropper.cropit("offset"),o=e.$imageCropper.cropit("imageSize"),n=o.height/o.width>1,a=0,s=0;return n?s=Math.abs(i.y)/t:a=Math.abs(i.x)/t,{x:a,y:s,verticle:n}}},App.scenes.create.initImageCropper=function(){var e=this;e.imageLoaded=!1,e.$imageCropper=$(".image-editor");var t=$(".cropit-image-preview-container");e.$mid2014Mailbox.css({padding:35*App.lomoRatio,"padding-bottom":0}),t.css({width:600*App.lomoRatio,height:600*App.lomoRatio}),e.$el.find("#article-footer").height(160*App.lomoRatio),e.$imageCropper.cropit({exportZoom:App.lomoRatio,imageState:{src:bootData.lomo_source_src},onImageLoaded:function(){e.imageLoaded=!0,$(".js-cropit-image-drag-tip").addClass(e.getImgOffset().verticle?"down":"right").one("touchstart click",function(e){e.stopPropagation(),e.preventDefault(),$("#cropit-image-tip-bg").hide(),$(this).hide()})}})},App.scenes.create.createMail=function(){var e=this,t=e.collectAndValideData();return t?(e.enterReadMode(),e.sendMailAnimation(function(){$("#js-fuji").classAnimoEnd("animate-bounceIn"),$(".white-loading").show(),App.apiCreate(t,function(t){if(t.status&&t.data&&t.data.lomo_img&&t.data.lomo_img_thumb){var i=[t.data.lomo_img,t.data.lomo_img_thumb];bootData.lomo_img_thumb=t.data.lomo_img_thumb,bootData.lomo_img=t.data.lomo_img,IFR.imgLoader(i,null,function(){App.transToScene("single",!0)})}else e.$submitBtn.removeAttr("disabled"),e.mailBackAnimation(),alert("出了点问题，"+t.message+"\n请稍后重新提交")})}),void 0):(e.$submitBtn.removeAttr("disabled"),void 0)},App.scenes.create.sendMailAnimation=function(e){var t=this;t.$el.removeClass("animo-rotateIn").classAnimoEnd("animate-rotateOut",function(){t.$el.hide(),IFR.showTipMask(".js-tip-create-waiting",!0),$(".js-tip-create-waiting").fadeIn("fast",function(){$("#js-fuji").classAnimoEnd("animate-bounceIn"),e&&e()})})},App.scenes.create.mailBackAnimation=function(){var e=this;$(".js-tip-create-waiting").fadeOut(function(){e.$el.removeClass("animate-rotateOut").classAnimoEnd("animo-rotateIn",function(){e.exitReadMode()})}),IFR.hideTipMask(".js-tip-create-waiting")
},App.scenes.create.enterReadMode=function(){var e=this;e.$el.addClass("read-mode")},App.scenes.create.exitReadMode=function(){var e=this;e.$el.removeClass("read-mode")},App.scenes.create.collectAndValideData=function(){var e=this,t=$.trim(e.$message.val()),i=$.trim(e.$wechatName.val()),o=e.$isShowWechatName[0].checked,n=e.$is_show_city[0].checked,a={},s=e.getImgOffset();if(i&&/.*[\u4e00-\u9fa5]+.*$/.test(i))return alert("微信号不能有中文"),!1;i&&App.lsSet("wechat_name",i);var r=App.countChinese(t);return r+=(t.length-r)/2,r>17?(alert("内容字数不能多于 17"),!1):(a={message:t,wechat_name:i,is_show_wechat_name:o,is_show_city:n,img_offset:s},App.city&&(a.city=App.city),App.networkType&&(a.network_type=App.networkType),a)},App.closeScene=function(e){$(App.scenesEl[e]).fadeOut()},App.transToScene=function(e,t){App.prevScene=App.currentScene,App.currentScene=e,App.prevScene&&(t&&$(App.scenesEl[App.prevScene]).fadeOut(),App.scenes[App.prevScene].exitScene(),$(App.scenesEl[App.prevScene]).off("."+App.prevScene+".ifr")),App.scenes[e].init()};for(var init=function(){App.secPadding=20,App.secInnerWidth=$(window).width()-2*App.secPadding,App.lomoRatio=App.secInnerWidth/670,$(".js-sec-inner").css({"min-height":795*App.lomoRatio+60}),App.currentMailId=bootData.lomo_id,App.lockShake=!1},runPage=function(){bootView&&(sceneName=bootView),App.transToScene(sceneName),$(".js-share-btn").on("click",function(){IFR.showTipMask("#tip-share-01")}),"album"!==bootView&&App.preloadLomos(),ns.getNetworkType(function(e){App.networkType=e})},imgSources=["lomo2014/bg-album-2.jpg","lomo2014/bg.jpg","lomo2014/camera.png","lomo2014/heart-break.png","lomo2014/heart.png","lomo2014/line.png","lomo2014/loading-camera.png","lomo2014/logos.png","lomo2014/meizu.png","lomo2014/move.png","lomo2014/move2.png","lomo2014/tip-album-open.png","lomo2014/tip-gesture-01.png","lomo2014/tip-share-02.png","lomo2014/wx.png","qrcode-scan.png"],i=0;imgSources.length>i;i++)imgSources[i]=CDN_IMG_URL+imgSources[i];bootData.lomo_img&&imgSources.push(bootData.lomo_img),bootData.lomo_img_thumb&&imgSources.push(bootData.lomo_img_thumb),setTimeout(function(){$("#loading").addClass("in")},500),setTimeout(function(){IFR.sourcesLoaded(imgSources,init,runPage)},1e3);